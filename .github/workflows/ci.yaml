name: CI

on:
  workflow_dispatch:
  pull_request:
   branches:
     - main
  schedule:
    - cron: '0 0 * * 6'
  push:
    branches:
      - main

env:
  SOURCE_DATE_EPOCH: 0
  DOCKER_BUILD_SUMMARY: false

jobs:
  build_images:
    runs-on: ${{ matrix.os }}
    outputs:
      digest_hadoop_base_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_base_11_amd64 }}
      digest_hadoop_client_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_client_11_amd64 }}
      digest_hadoop_client_spark_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_client_spark_11_amd64 }}
      digest_hadoop_hdfs_datanode_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_hdfs_datanode_11_amd64 }}
      digest_hadoop_hdfs_namenode_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_hdfs_namenode_11_amd64 }}
      digest_hadoop_mapred_jobhistoryserver_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_mapred_jobhistoryserver_11_amd64 }}
      digest_hadoop_yarn_resourcemanager_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_yarn_resourcemanager_11_amd64 }}
      digest_hadoop_yarn_nodemanager_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_yarn_nodemanager_11_amd64 }}
      digest_hadoop_yarn_nodemanager_spark_11_amd64: ${{ steps.publish_digest.outputs.digest_hadoop_yarn_nodemanager_spark_11_amd64 }}
      digest_hadoop_base_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_base_11_arm64 }}
      digest_hadoop_client_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_client_11_arm64 }}
      digest_hadoop_client_spark_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_client_spark_11_arm64 }}
      digest_hadoop_hdfs_datanode_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_hdfs_datanode_11_arm64 }}
      digest_hadoop_hdfs_namenode_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_hdfs_namenode_11_arm64 }}
      digest_hadoop_mapred_jobhistoryserver_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_mapred_jobhistoryserver_11_arm64 }}
      digest_hadoop_yarn_resourcemanager_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_yarn_resourcemanager_11_arm64 }}
      digest_hadoop_yarn_nodemanager_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_yarn_nodemanager_11_arm64 }}
      digest_hadoop_yarn_nodemanager_spark_11_arm64: ${{ steps.publish_digest.outputs.digest_hadoop_yarn_nodemanager_spark_11_arm64 }}

    permissions:
      contents: read
      packages: write
      attestations: write
      id-token: write

    strategy:
      matrix:
        include:
          - os: ubuntu-24.04
            arch: amd64
            java_version: "11"
          - os: ubuntu-24.04-arm
            arch: arm64
            java_version: "11"
    steps:
      -
        name: Checkout
        uses: actions/checkout@v5
      -
        name: Login to GitHub Container Registry
        if: github.event_name != 'pull_request'
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      -
        name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      -
        name: Build hadoop-base
        id: hadoop_base
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-base
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-base:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-client
        id: hadoop_client
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-client
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-client:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-client-spark
        id: hadoop_client_spark
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-client-spark
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-hdfs-datanode
        id: hadoop_hdfs_datanode
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-hdfs-datanode
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-hdfs-namenode
        id: hadoop_hdfs_namenode
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-hdfs-namenode
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-mapred-jobhistoryserver
        id: hadoop_mapred_jobhistoryserver
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-mapred-jobhistoryserver
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-yarn-resourcemanager
        id: hadoop_yarn_resourcemanager
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-yarn-resourcemanager
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-yarn-nodemanager
        id: hadoop_yarn_nodemanager
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-yarn-nodemanager
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Build hadoop-yarn-nodemanager-spark
        id: hadoop_yarn_nodemanager_spark
        uses: docker/build-push-action@v6
        with:
          push: ${{ github.event_name != 'pull_request' }}
          target: hadoop-yarn-nodemanager-spark
          build-args: |
            java_version=${{ matrix.java_version }}
          tags: |
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:latest-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4-java-${{ matrix.java_version }}-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4.2-${{ matrix.arch }}
            ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4.2-java-${{ matrix.java_version }}-${{ matrix.arch }}
      -
        name: Publish image digests
        id: publish_digest
        run: |
          arch="${{ matrix.arch }}"
          java_version="${{ matrix.java_version }}"

          digest_hadoop_base="${{ steps.hadoop_base.outputs.digest }}" 
          echo "digest_hadoop_base_${java_version}_${arch}=${digest_hadoop_base}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_client="${{ steps.hadoop_client.outputs.digest }}" 
          echo "digest_hadoop_client_${java_version}_${arch}=${digest_hadoop_client}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_client_spark="${{ steps.hadoop_client_spark.outputs.digest }}" 
          echo "digest_hadoop_client_spark_${java_version}_${arch}=${digest_hadoop_client_spark}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_hdfs_datanode="${{ steps.hadoop_hdfs_datanode.outputs.digest }}" 
          echo "digest_hadoop_hdfs_datanode_${java_version}_${arch}=${digest_hadoop_hdfs_datanode}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_hdfs_namenode="${{ steps.hadoop_hdfs_namenode.outputs.digest }}" 
          echo "digest_hadoop_hdfs_namenode_${java_version}_${arch}=${digest_hadoop_hdfs_namenode}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_mapred_jobhistoryserver="${{ steps.hadoop_mapred_jobhistoryserver.outputs.digest }}" 
          echo "digest_hadoop_mapred_jobhistoryserver_${java_version}_${arch}=${digest_hadoop_mapred_jobhistoryserver}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_yarn_resourcemanager="${{ steps.hadoop_yarn_resourcemanager.outputs.digest }}" 
          echo "digest_hadoop_yarn_resourcemanager_${java_version}_${arch}=${digest_hadoop_yarn_resourcemanager}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_yarn_nodemanager="${{ steps.hadoop_yarn_nodemanager.outputs.digest }}" 
          echo "digest_hadoop_yarn_nodemanager_${java_version}_${arch}=${digest_hadoop_yarn_nodemanager}" >> "$GITHUB_OUTPUT"
          
          digest_hadoop_yarn_nodemanager_spark="${{ steps.hadoop_yarn_nodemanager_spark.outputs.digest }}" 
          echo "digest_hadoop_yarn_nodemanager_spark_${java_version}_${arch}=${digest_hadoop_yarn_nodemanager_spark}" >> "$GITHUB_OUTPUT"

  build_manifests:
    runs-on: ubuntu-24.04
    needs: [build_images]
    if: github.event_name != 'pull_request'

    permissions:
      contents: read
      packages: write
      attestations: write
      id-token: write

    steps:
      -
        name: Login to GitHub Container Registry
        if: github.event_name != 'pull_request'
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      -
        name: Create and push hadoop-base manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-base:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-base:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_base_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-base:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_base_11_arm64 }}"
      -
        name: Create and push hadoop-client manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-client:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_client_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-client:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_client_11_arm64 }}"
      -
        name: Create and push hadoop-client-spark manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_client_spark_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-client-spark:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_client_spark_11_arm64 }}"
      -
        name: Create and push hadoop-hdfs-datanode manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_hdfs_datanode_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-datanode:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_hdfs_datanode_11_arm64 }}"
      -
        name: Create and push hadoop-hdfs-namenode manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_hdfs_namenode_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-hdfs-namenode:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_hdfs_namenode_11_arm64 }}"
      -
        name: Create and push hadoop-mapred-jobhistoryserver manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_mapred_jobhistoryserver_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-mapred-jobhistoryserver:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_mapred_jobhistoryserver_11_arm64 }}"
      -
        name: Create and push hadoop-yarn-resourcemanager manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_yarn_resourcemanager_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-resourcemanager:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_yarn_resourcemanager_11_arm64 }}"
      -
        name: Create and push hadoop-yarn-nodemanager manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_yarn_nodemanager_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_yarn_nodemanager_11_arm64 }}"
      -
        name: Create and push hadoop-yarn-nodemanager-spark manifest on GitHub Container Registry
        if: github.event_name != 'pull_request'
        run: |
          docker buildx imagetools create -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:latest" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4-java-11" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4.2" \
              -t "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:3.4.2-java-11" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:latest-amd64@${{ needs.build_images.outputs.digest_hadoop_yarn_nodemanager_spark_11_amd64 }}" \
              "ghcr.io/${{ github.repository_owner }}/hadoop-yarn-nodemanager-spark:latest-arm64@${{ needs.build_images.outputs.digest_hadoop_yarn_nodemanager_spark_11_arm64 }}"
